{#include base.html}
  {#title}CDs - Vintage Store{/}

  {#insert}
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <h1><i class="bi bi-disc me-2"></i>CDs</h1>
          <span class="badge bg-secondary fs-6">{cds.size} CDs on this page</span>
        </div>
        <hr>
      </div>
    </div>

    {! Filter and Sort controls !}
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <form method="get" action="/cds" class="row g-3 align-items-end">
              <input type="hidden" name="page" value="0">

              {! Stock filter !}
              <div class="col-md-2">
                <label class="form-label">Availability</label>
                <select name="inStock" class="form-select form-select-sm">
                  <option value="">All</option>
                  <option value="true" {#if inStock == true}selected{/if}>In Stock</option>
                  <option value="false" {#if inStock == false}selected{/if}>Out of Stock</option>
                </select>
              </div>

              {! Genre filter !}
              <div class="col-md-2">
                <label class="form-label">Genre</label>
                <select name="genre" class="form-select form-select-sm">
                  <option value="">All</option>
                  <option value="ROCK" {#if genre == 'ROCK'}selected{/if}>Rock</option>
                  <option value="POP" {#if genre == 'POP'}selected{/if}>Pop</option>
                  <option value="JAZZ" {#if genre == 'JAZZ'}selected{/if}>Jazz</option>
                  <option value="CLASSICAL" {#if genre == 'CLASSICAL'}selected{/if}>Classical</option>
                  <option value="ELECTRONIC" {#if genre == 'ELECTRONIC'}selected{/if}>Electronic</option>
                  <option value="HIP_HOP" {#if genre == 'HIP_HOP'}selected{/if}>Hip Hop</option>
                  <option value="COUNTRY" {#if genre == 'COUNTRY'}selected{/if}>Country</option>
                  <option value="BLUES" {#if genre == 'BLUES'}selected{/if}>Blues</option>
                  <option value="METAL" {#if genre == 'METAL'}selected{/if}>Metal</option>
                  <option value="OTHER" {#if genre == 'OTHER'}selected{/if}>Other</option>
                </select>
              </div>

              {! Label filter !}
              <div class="col-md-2">
                <label class="form-label">Label</label>
                <input type="text" name="label" class="form-control form-control-sm" placeholder="Search label..." value="{label ?: ''}">
              </div>

              {! Sort by !}
              <div class="col-md-2">
                <label class="form-label">Sort by</label>
                <select name="sortBy" class="form-select form-select-sm">
                  <option value="title" {#if sortBy == 'title'}selected{/if}>Title</option>
                  <option value="price" {#if sortBy == 'price'}selected{/if}>Price</option>
                </select>
              </div>

              {! Sort direction !}
              <div class="col-md-1">
                <label class="form-label">Order</label>
                <select name="sortDir" class="form-select form-select-sm">
                  <option value="asc" {#if sortDir == 'asc'}selected{/if}>Asc</option>
                  <option value="desc" {#if sortDir == 'desc'}selected{/if}>Desc</option>
                </select>
              </div>

              {! Items per page !}
              <div class="col-md-1">
                <label class="form-label">Per page</label>
                <select name="size" class="form-select form-select-sm">
                  <option value="10" {#if size == 10}selected{/if}>10</option>
                  <option value="50" {#if size == 50}selected{/if}>50</option>
                  <option value="100" {#if size == 100}selected{/if}>100</option>
                </select>
              </div>

              {! Apply button !}
              <div class="col-md-2">
                <button type="submit" class="btn btn-primary btn-sm w-100">
                  <i class="bi bi-funnel me-1"></i>Apply
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    {! Page info !}
    <div class="row mb-3">
      <div class="col-12">
        <span class="text-muted">Page {page + 1}</span>
      </div>
    </div>

    {#if cds.isEmpty}
      <div class="alert alert-info" role="alert">
        <i class="bi bi-info-circle me-2"></i>No CDs match your criteria.
        <a href="/cds" class="alert-link">Clear filters</a>
      </div>
    {#else}
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4">
        {#for cd in cds}
          <div class="col">
            <a href="/cds/{cd.id}" class="text-decoration-none">
              <div class="card h-100">
                <div class="card-header bg-info text-white">
                  <i class="bi bi-disc me-1"></i> CD
                  {#if cd.genre}
                    <span class="badge bg-light text-dark float-end">{cd.genre}</span>
                  {/if}
                </div>
                <div class="card-body">
                  <h5 class="card-title text-dark">{cd.title}</h5>
                  {#if cd.description}
                    <p class="card-text text-muted small">{#if cd.description.length > 150}{cd.description.substring(0, 150)}...{#else}{cd.description}{/if}</p>
                  {/if}
                  <ul class="list-unstyled mb-0 text-dark">
                    {#if cd.musicCompany}
                      <li><small><strong>Label:</strong> {cd.musicCompany}</small></li>
                    {/if}
                    {#if cd.releaseDate}
                      <li><small><strong>Released:</strong> {cd.releaseDate}</small></li>
                    {/if}
                  </ul>
                </div>
                <div class="card-footer bg-white">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="price-tag">${cd.price}</span>
                    {#if cd.stock > 0}
                      <span class="badge bg-success stock-badge"><i class="bi bi-check-circle me-1"></i>In Stock</span>
                    {#else}
                      <span class="badge bg-danger stock-badge"><i class="bi bi-x-circle me-1"></i>Out of Stock</span>
                    {/if}
                  </div>
                </div>
              </div>
            </a>
          </div>
        {/for}
      </div>

      {! Pagination controls bottom !}
      <nav aria-label="CDs pagination" class="mt-4">
        <ul class="pagination justify-content-center">
          {! Previous button !}
          <li class="page-item {#if page == 0}disabled{/if}">
            <a class="page-link" href="/cds?page={page - 1}&size={size}{#if inStock != null}&inStock={inStock}{/if}{#if genre != null}&genre={genre}{/if}{#if label != null}&label={label}{/if}&sortBy={sortBy}&sortDir={sortDir}" {#if page == 0}tabindex="-1" aria-disabled="true"{/if}>
              <i class="bi bi-chevron-left"></i> Previous
            </a>
          </li>

          {! Current page indicator !}
          <li class="page-item active">
            <span class="page-link">{page + 1}</span>
          </li>

          {! Next button - enabled if we got a full page of results !}
          <li class="page-item {#if cds.size < size}disabled{/if}">
            <a class="page-link" href="/cds?page={page + 1}&size={size}{#if inStock != null}&inStock={inStock}{/if}{#if genre != null}&genre={genre}{/if}{#if label != null}&label={label}{/if}&sortBy={sortBy}&sortDir={sortDir}" {#if cds.size < size}tabindex="-1" aria-disabled="true"{/if}>
              Next <i class="bi bi-chevron-right"></i>
            </a>
          </li>
        </ul>
      </nav>
    {/if}
  {/insert}
{/include}
